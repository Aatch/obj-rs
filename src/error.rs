//! Contains helper structs for error handling

use std::result;
use std::io;
use std::error::FromError;

/// A type for results generated by `load_obj` and `load_mtl` where the `Err` type
/// is hard-wired to `ObjError`.
///
/// This typedef is generally used to avoid writing out `io::Error` directly and
/// is otherwise a direct mapping to `std::result::Result`.
pub type ObjResult<T> = result::Result<T, ObjError>;

#[derive(PartialEq, Eq, Clone, Debug)]
enum ObjError {
    Io(io::Error),
    Parse(ParseError)
}

impl FromError<io::Error> for ObjError {
    fn from_error(err: io::Error) -> ObjError {
        ObjError::Io(err)
    }
}

impl FromError<ParseError> for ObjError {
    fn from_error(err: ParseError) -> ObjError {
        ObjError::Parse(err)
    }
}

/// The error type for I/O operations of the `Read`, `Write`, `Seek`, and
/// associated traits.
///
/// Errors mostly originate from the underlying OS, but custom instances of
/// `Error` can be created with crafted error messages and a particular value of
/// `ErrorKind`.
#[derive(PartialEq, Eq, Clone, Debug)]
pub struct ParseError {
    kind: ParseErrorKind,
    desc: &'static str,
}

/// A list specifying general categories of I/O error.
/// #[derive(Copy, PartialEq, Eq, Clone, Debug)]
#[derive(Copy, PartialEq, Eq, Clone, Debug)]
pub enum ParseErrorKind {
    /// Met unexpected statement
    UnexpectedStatement,
    /// Received wrong number of arguments
    WrongNumberOfArguments,
}

impl ParseError {
    /// Creates a new custom error from a specified kind/description.
    pub fn new(kind: ParseErrorKind, desc: &'static str) -> Self {
        ParseError { kind: kind, desc: desc }
    }
}

macro_rules! error {
    ($kind:ident, $desc:expr) => {
        return Err(
            ::std::error::FromError::from_error(
                $crate::error::ParseError::new(
                    $crate::error::ParseErrorKind::$kind, $desc
                )
            )
        )
    }
}
